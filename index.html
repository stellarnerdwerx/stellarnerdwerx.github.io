<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/style.css">
    <link rel="icon" href="assets/icon.png">
    <title>PlayPickr</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/sql.js@1.12.0/dist/sql-wasm.min.js"></script>
<body>
    <header>
        <h1>Welcome to PlayPickr</h1>
        <p>Your ultimate library for movies, video games, and board games</p>
    </header>

    <nav>
        <ul>
            <li><a href="#movies">Movies</a></li>
            <li><a href="#games">Games</a></li>
            <li><a href="#boardgames">Board Games</a></li>
        </ul>
    </nav>

    <!-- Movies Section -->
    <section id="movies">
        <h2>Movies</h2>
        <div class="search">
            <!-- Text search for title -->
            <input type="text" id="movie-search" placeholder="Search movies...">

            <!-- Dropdown for format selection -->
            <select id="movie-format">
                <option value="">Select Format</option>
                <option value="dvd">DVD</option>
                <option value="bluray">Blu-ray</option>
                <option value="three_d">3D Blu-ray</option>
                <option value="four_k">4K</option>
            </select>

            <!-- Dropdown for genre selection -->
            <select id="movie-genre">
                <option value="">Select Genre</option>
                <option value="action">Action</option>
                <option value="animation">Animation</option>
                <option value="comedy">Comedy</option>
                <option value="drama">Drama</option>
                <option value="family">Family</option>
                <option value="holiday">Holiday</option>
                <option value="horror">Horror</option>
                <option value="mystery">Mystery</option>
                <option value="romance">Romance</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="thriller">Thriller</option>
            </select>

            <!-- Search button -->
            <button onclick="searchMovies()">Search</button>
        </div>

        <!-- Movie results will appear here -->
        <ul id="movie-list"></ul>
    </section>
        <!-- SQLite.js Library -->
<script>
    const sqlConfig = {
    locateFile: file => `https://cdn.jsdelivr.net/npm/sql.js@1.12.0/dist/${file}`
    };

    let db;

    // Load the SQLite database
    async function loadDatabase() {
    try {
        // First, initialize SQL.js
        const SQL = await initSqlJs(sqlConfig);
        
        // Then fetch the database file
        const response = await fetch('assets/playpickr.db');
        if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
        }
        const buffer = await response.arrayBuffer();
        
        // Create the database instance
        db = new SQL.Database(new Uint8Array(buffer));
        console.log('Database loaded successfully!');
    } catch (error) {
        console.error('Database loading error:', error);
        document.getElementById('movie-list').innerHTML = 
        '<li class="error">Error loading database. Please check console for details.</li>';
    }
    }

    // Function to safely escape SQL string inputs
    function escapeSQL(str) {
    if (typeof str !== 'string') return str;
    return str.replace(/[\0\x08\x09\x1a\n\r"'\\\%]/g, char => {
        switch (char) {
        case "'":
            return "''";
        default:
            return char;
        }
    });
    }

    // Function to search for movies
    function searchMovies() {
    try {
        if (!db) {
        throw new Error('Database not loaded yet');
        }

        const title = escapeSQL(document.getElementById('movie-search').value.toLowerCase());
        const genre = escapeSQL(document.getElementById('movie-genre').value.toLowerCase());
        const format = escapeSQL(document.getElementById('movie-format').value);

        // Build the query with parameters to prevent SQL injection
        let query = `
        SELECT 
            title, 
            genres, 
            year, 
            runtime, 
            rating, 
            plot, 
            cast, 
            director 
        FROM movies 
        WHERE 1=1
        `;

        if (title) {
        query += ` AND LOWER(title) LIKE '%${title}%'`;
        }
        
        if (genre) {
        query += ` AND LOWER(genres) LIKE '%${genre}%'`;
        }
        
        if (format) {
        query += ` AND ${format} = 1`;
        }

        // Execute the query
        const results = db.exec(query);
        
        // Display results
        const movieList = document.getElementById('movie-list');
        movieList.innerHTML = '';

        if (results.length > 0 && results[0].values.length > 0) {
        results[0].values.forEach(movie => {
            const listItem = document.createElement('li');
            listItem.className = 'movie-item';
            listItem.innerHTML = `
            <div class="movie-title">${movie[0]}</div>
            <div class="movie-meta">
                <span>${movie[2]} | ${movie[3]} mins | ${movie[4]}/10</span>
            </div>
            <div class="movie-genres">${movie[1]}</div>
            <div class="movie-plot">${movie[5]}</div>
            <div class="movie-cast">Cast: ${movie[6]}</div>
            <div class="movie-director">Director: ${movie[7]}</div>
            `;
            movieList.appendChild(listItem);
        });
        } else {
        movieList.innerHTML = '<li class="no-results">No movies found matching your criteria.</li>';
        }
    } catch (error) {
        console.error('Search error:', error);
        document.getElementById('movie-list').innerHTML = 
        '<li class="error">Error performing search. Please check console for details.</li>';
    }
    }

    // Add event listeners
    document.addEventListener('DOMContentLoaded', () => {
    loadDatabase();
    
    // Add event listener for enter key on search input
    document.getElementById('movie-search').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
        searchMovies();
        }
    });

    // Add event listeners for select changes
    document.getElementById('movie-format').addEventListener('change', searchMovies);
    document.getElementById('movie-genre').addEventListener('change', searchMovies);
    });
</script>
    </section>

    <!-- Games Section -->
    <section id="games">
        <h2>Games</h2>
        <div class="search">
            <input type="text" id="game-search" placeholder="Search games...">
            <select id="game-console">
                <option value="">Select Console</option>
                <option value="NES">NES</option>
                <option value="SNES">SNES</option>
                <option value="N64">Nintendo 64</option>
                <option value="GAMECUBE">Gamecube</option>
                <option value="WII">Wii</option>
                <option value="WII_U">Wii U</option>
                <option value="SWITCH">Switch</option>
                <option value="GAMEBOY">Gameboy</option>
                <option value="GAMEBOY_COLOR">Gameboy Color</option>
                <option value="GAMEBOY_ADVANCE">Gameboy Advance</option>
                <option value="DS">DS</option>
                <option value="THREE_DS">3DS</option>
                <option value="PS1">Playstation 1</option>
                <option value="PS2">Playstation 2</option>
                <option value="PS3">Playstation 3</option>
                <option value="PS4">Playstation 4</option>
                <option value="PS5">Playstation 5</option>
                <option value="PS4_VR">Playstation VR</option>
                <option value="PSP">Playstation Portable</option>
                <option value="PS_VITA">Playstation Vita</option>
                <option value="SEGA_GENESIS">Sega Genesis</option>
                <option value="SEGA_CD">Sega CD</option>
                <option value="SEGA_GAMEGEAR">Sega Gamegear</option>
                <option value="TENGEN">Tengen</option>
                <option value="XBOX">XBOX</option>
                <option value="XBOX_360">XBOX 360</option>
                <option value="XBOX_KINECT">XBOX Kinect</option>
                <option value="XBOX_ONE">XBOX One</option>
            </select>
            <button onclick="searchGames()">Search</button>
        </div>
        <ul id="game-list">
            <!-- Game results will appear here -->
        </ul>
    </section>

    <!-- Board Games Section -->
    <section id="boardgames">
        <h2>Board Games</h2>
        <div class="search">
            <input type="text" id="boardgame-search" placeholder="Search board games...">
            <select id="boardgame-category">
                <option value="">Select Category</option>
                <option value="Adventure">Adventure</option>
                <option value="Cards">Cards</option>
                <option value="Children">Children</option>
                <option value="Deck-building">Deck-building</option>
                <option value="Dice">Dice</option>
                <option value="Expansion">Expansion</option>
                <option value="Family">Family</option>
                <option value="Party">Party</option>
                <option value="Puzzle">Puzzle</option>
                <option value="Strategy">Strategy</option>
                <option value="Thematic">Thematic</option>
            </select>
            <button onclick="searchBoardGames()">Search</button>
        </div>
        <ul id="boardgame-list">
            <!-- Board game results will appear here -->
        </ul>
    </section>

    <footer>
        <p>&copy; 2025 PlayPickr. All rights reserved.</p>
    </footer>

</body>
</html>
