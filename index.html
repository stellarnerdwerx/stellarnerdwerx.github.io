<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/style.css">
    <title>PlayPickr</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/sql.js@1.7.1/dist/sql-wasm.js"></script>
<body>
    <header>
        <h1>Welcome to PlayPickr</h1>
        <p>Your ultimate library for movies, video games, and board games</p>
    </header>

    <nav>
        <ul>
            <li><a href="#movies">Movies</a></li>
            <li><a href="#games">Games</a></li>
            <li><a href="#boardgames">Board Games</a></li>
        </ul>
    </nav>

    <!-- Movies Section -->
    <section id="movies">
        <h2>Movies</h2>
        <div class="search">
            <!-- Text search for title -->
            <input type="text" id="movie-search" placeholder="Search movies...">

            <!-- Dropdown for format selection -->
            <select id="movie-format">
                <option value="">Select Format</option>
                <option value="dvd">DVD</option>
                <option value="bluray">Blu-ray</option>
                <option value="3dbluray">3D Blu-ray</option>
                <option value="4k">4K</option>
            </select>

            <!-- Dropdown for genre selection -->
            <select id="movie-genre">
                <option value="">Select Genre</option>
                <option value="action">Action</option>
                <option value="animation">Animation</option>
                <option value="comedy">Comedy</option>
                <option value="drama">Drama</option>
                <option value="family">Family</option>
                <option value="holiday">Holiday</option>
                <option value="horror">Horror</option>
                <option value="mystery">Mystery</option>
                <option value="romance">Romance</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="thriller">Thriller</option>
            </select>

            <!-- Search button -->
            <button onclick="searchMovies()">Search</button>
        </div>

        <!-- Movie results will appear here -->
        <ul id="movie-list"></ul>
    </section>

    <!-- SQLite.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/sql.js@1.7.1/dist/sql-wasm.js"></script>

    <script>
        let db;

        // Load the SQLite database
        async function loadDatabase() {
            const response = await fetch('assets/playpickr.db');
            const buffer = await response.arrayBuffer();

            // Load the database from the array buffer
            const SQL = await initSqlJs({
                locateFile: file => `https://cdn.jsdelivr.net/npm/sql.js@1.7.1/dist/${file}`
            });

            db = new SQL.Database(new Uint8Array(buffer));
            console.log('Database loaded!');
        }

        // Function to search for movies by title, genre, and format
        async function searchMovies() {
            const title = document.getElementById('movie-search').value.toLowerCase();
            const genre = document.getElementById('movie-genre').value.toLowerCase();
            const format = document.getElementById('movie-format').value;

            // Start building the WHERE clause
            let whereClause = "WHERE 1=1"; // Start with a condition that's always true

            if (title) {
                whereClause += ` AND LOWER(title) LIKE '%${title}%'`;
            }

            if (genre) {
                whereClause += ` AND LOWER(genres) LIKE '%${genre}%'`;
            }

            if (format) {
                whereClause += ` AND LOWER(${format}) = 1`;  // Format fields are stored as 1 (for true)
            }

            // Run the SQL query to search for movies
            const query = `SELECT title, genres, year, runtime, rating, plot, cast, director FROM movies ${whereClause}`;
            const results = db.exec(query);

            // Process and display the results
            if (results.length > 0) {
                const movieList = results[0].values;
                displayMovies(movieList);
            } else {
                alert("No movies found.");
            }
        }

        // Function to display movies in the UI
        function displayMovies(movies) {
            const movieList = document.getElementById('movie-list');
            movieList.innerHTML = ''; // Clear previous results

            movies.forEach(movie => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <strong>${movie[0]}</strong> <br>
                    <em>Genre: ${movie[1]}</em> <br>
                    <em>Year: ${movie[2]}</em> <br>
                    <em>Rating: ${movie[4]}</em> <br>
                    <em>Cast: ${movie[6]}</em> <br>
                    <p>${movie[5]}</p>
                `;
                movieList.appendChild(listItem);
            });
        }

        // Load the database when the page loads
        window.onload = loadDatabase;
    </script>
    </section>

    <!-- Games Section -->
    <section id="games">
        <h2>Games</h2>
        <div class="search">
            <input type="text" id="game-search" placeholder="Search games...">
            <select id="game-console">
                <option value="">Select Console</option>
                <option value="NES">NES</option>
                <option value="SNES">SNES</option>
                <option value="Nintendo64">Nintendo 64</option>
                <option value="Gamecube">Gamecube</option>
                <option value="Wii">Wii</option>
                <option value="WiiU">Wii U</option>
                <option value="Switch">Switch</option>
                <option value="Gameboy">Gameboy</option>
                <option value="GameboyColor">Gameboy Color</option>
                <option value="GameboyAdvance">Gameboy Advance</option>
                <option value="DS">DS</option>
                <option value="3DS">3DS</option>
                <option value="PS1">Playstation 1</option>
                <option value="PS2">Playstation 2</option>
                <option value="PS3">Playstation 3</option>
                <option value="PS4">Playstation 4</option>
                <option value="PS5">Playstation 5</option>
                <option value="PSVR">Playstation VR</option>
                <option value="PSP">Playstation Portable</option>
                <option value="PSVita">Playstation Vita</option>
                <option value="Genesis">Sega Genesis</option>
                <option value="SegaCD">Sega CD</option>
                <option value="SegaGamegear">Sega Gamegear</option>
                <option value="Tengen">Tengen</option>
                <option value="XBOX">XBOX</option>
                <option value="XBOX360">XBOX 360</option>
                <option value="XBOXKinect">XBOX Kinect</option>
                <option value="XBOXOne">XBOX One</option>
            </select>
            <button onclick="searchGames()">Search</button>
        </div>
        <ul id="game-list">
            <!-- Game results will appear here -->
        </ul>
    </section>

    <!-- Board Games Section -->
    <section id="boardgames">
        <h2>Board Games</h2>
        <div class="search">
            <input type="text" id="boardgame-search" placeholder="Search board games...">
            <select id="boardgame-category">
                <option value="">Select Category</option>
                <option value="Adventure">Adventure</option>
                <option value="Cards">Cards</option>
                <option value="Children">Children</option>
                <option value="Deck-building">Deck-building</option>
                <option value="Dice">Dice</option>
                <option value="Expansion">Expansion</option>
                <option value="Family">Family</option>
                <option value="Party">Party</option>
                <option value="Puzzle">Puzzle</option>
                <option value="Strategy">Strategy</option>
                <option value="Thematic">Thematic</option>
            </select>
            <button onclick="searchBoardGames()">Search</button>
        </div>
        <ul id="boardgame-list">
            <!-- Board game results will appear here -->
        </ul>
    </section>

    <footer>
        <p>&copy; 2025 PlayPickr. All rights reserved.</p>
    </footer>

    <script src="app.js"></script>
</body>
</html>
